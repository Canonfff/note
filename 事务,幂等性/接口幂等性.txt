2019-01-30 

描述:

> 在做预算控制需求的时候,出现了一个比较头疼的bug;
>
> 预算控制涉及到扣款的操作,在驳回保存的时候,是先进行了返现,然后进行扣款;但是这样会有一个问题
>
> 因为返现和扣款之间,有一个数据校验,数据校验不通过;导致了返现成功,但是扣款操作未执行
>
> 那么就会引发一个问题,就是不断的返现,导致数额不对
>
> 出现这样的原因,是由于dubbo接口的远程调用导致事务无法迁移;所以,有必要将其弄在同一个事务里面;
>
> 原本我想着是用分布式事务去处理的
>
> 与秋文,肖尊华讨论过后,决定不那样处理了,而是将返现|扣款,这两个操作变成同一个步骤
>
> 返现与扣款作为同一个事务处理
>
> 但是这样也会有问题,因为dubbo接口有可能调用失败,更有可能超时等不可预知的原因
>
> 这样导致了返现|扣款成功,却导致本身的事务失败;



分布式事务现在已经开始慢慢的要接触了;不然之后可能会继续碰到这类问题
2019-10-24

最近在github上clone了一个项目,此项目的作用是单点登录;这个项目比较小;因此方便对各个模块代码进行解剖;

以此笔记来记录我的阅读情况,以及源码理解;

使用的技术栈是cas以及shiro

单点登录参考网站:
	https://www.cnblogs.com/ywlaker/p/6113927.html


1.单点登录理解
	1.为什么要单点登录?
		本质就是保护服务器资源;

	2.怎么实现?
		单系统的实现方式:

		1.cookie
			1.服务器在第一次请求的时候创建一个会话id;将会话id返回到浏览器;
			2.浏览器下次请求的带上这个会话id;

		2.登录状态
			1.第一次请求验证用户的身份合法性;
			2.设置在session中

		单系统的解决方案核心是cookie;cookie携带会话id在浏览器与服务器之间维护会话状态;而且cookie有限制,这个限制就是cookie的域（通常对应网站的域名），浏览器发送http请求时会自动携带与该域匹配的cookie，而不是所有cookie

			cookie域的理解

			说白了就是,顶级域名拿不到二级域名的cookie
			导致cookie不能共享

		参考网站
		https://blog.csdn.net/qq_36470686/article/details/82980630



	单点登录系统
		sso 认证中心

		子系统

		登录

		用户登录是在sso认证中心得到授权之后在各个子系统里面获取服务器受保护资源
		子系统不提供登录入口


		用户与sso认证中心创建全局会话;
		用户使用令牌与子系统之间创建的会话是局部会话;

			局部会话存在，全局会话一定存在
			全局会话存在，局部会话不一定存在
			全局会话销毁，局部会话必须销毁

		注销

		用户申请注销,认证中心注销用户信息,销毁全局会话,销毁局部会话





		单点登录模块

			sso-client

			拦截子系统未登录用户请求，跳转至sso认证中心
			接收并存储sso认证中心发送的令牌
			与sso-server通信，校验令牌的有效性
			建立局部会话
			拦截用户注销请求，向sso认证中心发送注销请求
			接收sso认证中心发出的注销请求，销毁局部会话

		　　sso-server

			验证用户的登录信息
			创建全局会话
			创建授权令牌
			与sso-client通信发送令牌
			校验sso-client令牌有效性
			系统注册
			接收sso-client注销请求，注销所有会话




		sso与cas
			
			参考网站
				https://blog.csdn.net/u013406199/article/details/80258608


			sso两种架构:
				1.集中验证

				2.多点验证


			三种技术实现:
				1.代理登录 agent

				2.令牌环 token
 
				3.身份票据 ticket



			cas框架

				1.cas-server
					cas服务器-->需要单独部署

				2.cas-client

					cas客户端


			sso 是单点登录
			cas 是实现单点登录的一种框架






github 单点登录项目smart 源码阅读

	1.在通过sso-demo的web.xml文件配置了sso-client的过滤器  smartFilter

	2.在application.xml配置了过滤器集合




mmp,又双叒叕做完了所有的任务了;最近一两个月真的是无聊到透顶;每天都是做一些很无聊的事情;
其实做的东西都很简单;而且对于我来说这些东西都已经写的有些厌烦了;

还是看一下开源项目的cas的单点登录的方案;

目前来说,对于自己的提升这方面还有很多的不足之处;优秀的程序员不仅仅是在于业务的CURD上而是,在对于自己所处的领域内
可以清晰明白的了解自己的不足,以及对于知识不断的追求


xxl-sso
开源的sso单点登录方案;
这是我看的第二个单点登录方案了
https://www.xuxueli.com/xxl-sso/#/

https://github.com/xuxueli/xxl-sso

先mark一下;
其次,我想应该更注重于对单元测试以及项目的了解;对于底层方案的实现更加的熟悉;


这里需要使用的是单独的一台服务器(可支持集群)

先说说架构图:
	1.浏览器客户端都是请求服务器,然后服务器请求单点登录服务器;将用户信息带到单点登录服务服务器;
	2.单点登录服务器对用户信息进行校验;如果没有登录那么就重定向到登录页面
	3.如果用户已经登录,那么返回一个局部会话session
	

2019-12-02 最近有耽搁了看这个源码的速度了;
好像总是有事情去做,但是最近事情真的不多,只是自己的太过懒了而已


继续搞我的单点登录吧,我擦咧;这个单点登录真的玩了好久啊


妈耶!又不知道搞了什么鬼东西;这个玩意不好弄啊;
还是继续看我的单点登录吧;


	首先是看pom文件
	两个samples-web里面都是引入了core这个jar包;可见;这里单点登录是通过了core实现的


	web.xml配置

	我发现springboot并没有这么多幺儿子;
	连特么的web.xml都没有,也没有spring的配置信息;我擦咧;


	mmp,这个东西比之前那种东西更加难以理解了;
	不过问题不大,我还是可以找出来的



	首先是看web的Controller


	直接看config
	这里,使用了一个Config注解,将拦截器添加到spring的管理中;妈的,这些人才;
	真是鸡儿难懂

	XxlSsoTokenFilter
		1.匹配路径,是否过滤


	这个开源项目好像有点问题,目前来说,都没有看到对于cas服务的登录;是不是哪里有问题?还是我漏看了什么?








